<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collection Book Pro - Lending Management System (Offline)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .icon {
            width: 1.25rem;
            height: 1.25rem;
            stroke: currentColor;
            fill: none;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- IndexedDB Helper ---
        const db = {
            _db: null,
            init: function() {
                return new Promise((resolve, reject) => {
                    if (this._db) {
                        return resolve(this._db);
                    }
                    const request = indexedDB.open('CollectionBookProDB', 2);
                    
                    request.onerror = (event) => {
                        console.error("Database error:", event.target.errorCode);
                        reject("Database error");
                    };
                    
                    request.onsuccess = (event) => {
                        this._db = event.target.result;
                        resolve(this._db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        if (!db.objectStoreNames.contains('clients')) {
                            db.createObjectStore('clients', { keyPath: 'id' });
                        }
                        if (!db.objectStoreNames.contains('collections')) {
                            const collectionsStore = db.createObjectStore('collections', { keyPath: 'id' });
                            collectionsStore.createIndex('type', 'type', { unique: false });
                        }
                    };
                });
            },
            
            add: function(storeName, item) {
                return new Promise((resolve, reject) => {
                    const transaction = this._db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.add(item);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            put: function(storeName, item) {
                return new Promise((resolve, reject) => {
                    const transaction = this._db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.put(item);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },

            delete: function(storeName, id) {
                return new Promise((resolve, reject) => {
                    const transaction = this._db.transaction([storeName], 'readwrite');
                    const store = transaction.objectStore(storeName);
                    const request = store.delete(id);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            },

            getAll: function(storeName) {
                return new Promise((resolve, reject) => {
                    const transaction = this._db.transaction([storeName], 'readonly');
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
        };

        // Icon components (simplified Lucide React icons)
        const Database = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                <path d="m3 5 0 14c0 1.66 4.03 3 9 3s9-1.34 9-3V5"/>
                <path d="M3 12c0 1.66 4.03 3 9 3s9-1.34 9-3"/>
            </svg>
        );

        const BookOpen = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/>
                <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>
            </svg>
        );

        const Plus = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M5 12h14"/>
                <path d="m12 5v14"/>
            </svg>
        );

        const Building = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/>
                <path d="M6 12h4v2h-4z"/>
                <path d="M6 8h4v2h-4z"/>
                <path d="M10 16h4v2h-4z"/>
                <path d="M10 20h4v2h-4z"/>
                <path d="M14 12h4v2h-4z"/>
                <path d="M14 8h4v2h-4z"/>
            </svg>
        );

        const Smartphone = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <rect width="14" height="20" x="5" y="2" rx="2" ry="2"/>
                <path d="M12 18h.01"/>
            </svg>
        );

        const UserX = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="m17 8 5 5"/>
                <path d="m22 8-5 5"/>
            </svg>
        );

        const TrendingUp = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <polyline points="22,7 13.5,15.5 8.5,10.5 2,17"/>
                <polyline points="16,7 22,7 22,13"/>
            </svg>
        );

        const DollarSign = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <line x1="12" y1="1" x2="12" y2="23"/>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
        );

        const User = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
            </svg>
        );

        const Edit = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="m18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/>
            </svg>
        );

        const Trash2 = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M3 6h18"/>
                <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/>
                <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                <line x1="10" y1="11" x2="10" y2="17"/>
                <line x1="14" y1="11" x2="14" y2="17"/>
            </svg>
        );

        const Search = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
            </svg>
        );

        const BarChart3 = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <path d="M3 3v18h18"/>
                <path d="M18 17V9"/>
                <path d="M13 17V5"/>
                <path d="M8 17v-3"/>
            </svg>
        );

        const Calendar = () => (
            <svg className="icon" viewBox="0 0 24 24">
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                <line x1="16" y1="2" x2="16" y2="6"/>
                <line x1="8" y1="2" x2="8" y2="6"/>
                <line x1="3" y1="10" x2="21" y2="10"/>
            </svg>
        );

        // Database Tab Component
        const DatabaseTab = ({ clients, setClients }) => {
            const [showModal, setShowModal] = useState(false);
            const [editingClient, setEditingClient] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [formData, setFormData] = useState({
                name: '',
                loanAmount: ''
            });

            const calculateLoanDetails = (loanAmount) => {
                const totalAmount = loanAmount * 1.2; // 20% interest
                const dailyPayment = totalAmount / 48; // 48 days total
                return { totalAmount, dailyPayment };
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                const loanAmount = parseFloat(formData.loanAmount);
                const { totalAmount, dailyPayment } = calculateLoanDetails(loanAmount);
                
                if (editingClient) {
                    const updatedClient = { ...editingClient, name: formData.name, loanAmount, totalAmount, dailyPayment };
                    await db.put('clients', updatedClient);
                    setClients(clients.map(client => client.id === editingClient.id ? updatedClient : client));
                } else {
                    const newClient = {
                        id: Date.now(),
                        name: formData.name,
                        loanAmount,
                        totalAmount,
                        dailyPayment,
                        createdAt: new Date().toISOString()
                    };
                    await db.add('clients', newClient);
                    setClients([...clients, newClient]);
                }
                
                setShowModal(false);
                setEditingClient(null);
                setFormData({ name: '', loanAmount: '' });
            };

            const handleEdit = (client) => {
                setEditingClient(client);
                setFormData({ name: client.name, loanAmount: client.loanAmount.toString() });
                setShowModal(true);
            };

            const handleDelete = async (clientId) => {
                if (window.confirm('Are you sure you want to delete this client? This cannot be undone.')) {
                    await db.delete('clients', clientId);
                    setClients(clients.filter(client => client.id !== clientId));
                }
            };

            const filteredClients = clients.filter(client =>
                client.name.toLowerCase().includes(searchTerm.toLowerCase())
            );

            return (
                <div className="space-y-6">
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 className="text-2xl font-bold text-gray-800">Client Database</h2>
                        <button
                            onClick={() => setShowModal(true)}
                            className="flex items-center space-x-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"
                        >
                            <Plus />
                            <span>Add New Client</span>
                        </button>
                    </div>

                    <div className="relative">
                        <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                            <Search />
                        </div>
                        <input
                            type="text"
                            placeholder="Search clients..."
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                            className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                    </div>

                    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Loan Amount</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total Amount</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Daily Payment</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date Added</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredClients.map((client) => (
                                        <tr key={client.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap">
                                                <div className="flex items-center">
                                                    <div className="flex-shrink-0 h-10 w-10">
                                                        <div className="h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center">
                                                            <User />
                                                        </div>
                                                    </div>
                                                    <div className="ml-4">
                                                        <div className="text-sm font-medium text-gray-900">{client.name}</div>
                                                    </div>
                                                </div>
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{client.loanAmount.toFixed(2)}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{client.totalAmount.toFixed(2)}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{client.dailyPayment.toFixed(2)}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                                {new Date(client.createdAt).toLocaleDateString()}
                                            </td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                <div className="flex space-x-2">
                                                    <button onClick={() => handleEdit(client)} className="text-blue-600 hover:text-blue-900"><Edit /></button>
                                                    <button onClick={() => handleDelete(client.id)} className="text-red-600 hover:text-red-900"><Trash2 /></button>
                                                </div>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {filteredClients.length === 0 && (
                        <div className="text-center py-12">
                            <User className="mx-auto h-12 w-12 text-gray-400" />
                            <h3 className="mt-2 text-sm font-medium text-gray-900">No clients found</h3>
                            <p className="mt-1 text-sm text-gray-500">Get started by adding a new client.</p>
                        </div>
                    )}

                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                <h3 className="text-lg font-medium text-gray-900 mb-4">{editingClient ? 'Edit Client' : 'Add New Client'}</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Client Name</label>
                                        <input type="text" required value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter client name" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Loan Amount (₱)</label>
                                        <input type="number" required min="0" step="0.01" value={formData.loanAmount} onChange={(e) => setFormData({ ...formData, loanAmount: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter loan amount" />
                                    </div>
                                    {formData.loanAmount && (
                                        <div className="bg-blue-50 p-3 rounded-md">
                                            <p className="text-sm text-blue-800"><strong>Total Amount (with 20% interest):</strong> ₱{(parseFloat(formData.loanAmount || 0) * 1.2).toFixed(2)}</p>
                                            <p className="text-sm text-blue-800"><strong>Daily Payment:</strong> ₱{((parseFloat(formData.loanAmount || 0) * 1.2) / 48).toFixed(2)}</p>
                                        </div>
                                    )}
                                    <div className="flex space-x-3 pt-4">
                                        <button type="button" onClick={() => { setShowModal(false); setEditingClient(null); setFormData({ name: '', loanAmount: '' }); }} className="flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">Cancel</button>
                                        <button type="submit" className="flex-1 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700">{editingClient ? 'Update' : 'Add'} Client</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Collection Tab Component
        const CollectionTab = ({ type, clients, collections, setCollections }) => {
            const [showModal, setShowModal] = useState(false);
            const [selectedClient, setSelectedClient] = useState('');
            const [paymentAmount, setPaymentAmount] = useState('');
            const [searchTerm, setSearchTerm] = useState('');

            const handleAddEntry = async (e) => {
                e.preventDefault();
                const client = clients.find(c => c.id === parseInt(selectedClient));
                if (!client) return;

                let amount = parseFloat(paymentAmount);
                
                if (type === 'notebook') {
                    const today = new Date().getDay();
                    if (today === 1) amount = 185; // Monday
                    if (today === 6) amount = 190; // Saturday
                }

                const newEntry = {
                    id: Date.now(),
                    type: type,
                    clientId: client.id,
                    clientName: client.name,
                    amount: amount,
                    date: new Date().toISOString(),
                    notes: ''
                };

                await db.add('collections', newEntry);
                setCollections([...collections, newEntry]);
                setShowModal(false);
                setSelectedClient('');
                setPaymentAmount('');
            };

            const handleDeleteEntry = async (entryId) => {
                if (window.confirm('Are you sure you want to delete this entry?')) {
                    await db.delete('collections', entryId);
                    setCollections(collections.filter(entry => entry.id !== entryId));
                }
            };

            const filteredCollections = collections.filter(entry =>
                entry.clientName.toLowerCase().includes(searchTerm.toLowerCase())
            );

            const getTabTitle = () => {
                const titles = { notebook: 'Notebook Collections', add: 'ADD Collections', office: 'Office Collections', gcash: 'GCash Collections', absent: 'Absent Collections' };
                return titles[type] || 'Collections';
            };

            return (
                <div className="space-y-6">
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 className="text-2xl font-bold text-gray-800">{getTabTitle()}</h2>
                        <button onClick={() => setShowModal(true)} className="flex items-center space-x-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"><Plus /><span>Add Entry</span></button>
                    </div>

                    <div className="relative">
                        <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"><Search /></div>
                        <input type="text" placeholder="Search entries..." value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                    </div>

                    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Client Name</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {filteredCollections.map((entry) => (
                                        <tr key={entry.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap"><div className="text-sm font-medium text-gray-900">{entry.clientName}</div></td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{entry.amount.toFixed(2)}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(entry.date).toLocaleDateString()}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium"><button onClick={() => handleDeleteEntry(entry.id)} className="text-red-600 hover:text-red-900"><Trash2 /></button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {filteredCollections.length === 0 && (
                        <div className="text-center py-12">
                            <BookOpen className="mx-auto h-12 w-12 text-gray-400" />
                            <h3 className="mt-2 text-sm font-medium text-gray-900">No entries found</h3>
                            <p className="mt-1 text-sm text-gray-500">Start by adding a payment entry.</p>
                        </div>
                    )}

                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                <h3 className="text-lg font-medium text-gray-900 mb-4">Add Payment Entry</h3>
                                <form onSubmit={handleAddEntry} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Select Client</label>
                                        <select required value={selectedClient} onChange={(e) => { setSelectedClient(e.target.value); const client = clients.find(c => c.id === parseInt(e.target.value)); if (client) { setPaymentAmount(client.dailyPayment.toString()); } }} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                            <option value="">Choose a client...</option>
                                            {clients.map(client => (<option key={client.id} value={client.id}>{client.name} - ₱{client.dailyPayment.toFixed(2)}</option>))}
                                        </select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Payment Amount (₱)</label>
                                        <input type="number" required min="0" step="0.01" value={paymentAmount} onChange={(e) => setPaymentAmount(e.target.value)} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter payment amount" />
                                    </div>
                                    {type === 'notebook' && (<div className="bg-yellow-50 p-3 rounded-md"><p className="text-sm text-yellow-800"><strong>Note:</strong> Sunday payments are distributed - Monday: ₱185, Saturday: ₱190</p></div>)}
                                    <div className="flex space-x-3 pt-4">
                                        <button type="button" onClick={() => { setShowModal(false); setSelectedClient(''); setPaymentAmount(''); }} className="flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">Cancel</button>
                                        <button type="submit" className="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700">Add Entry</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ADV Tab Component
        const ADVTab = ({ collections, setCollections }) => {
            const [showModal, setShowModal] = useState(false);
            const [formData, setFormData] = useState({
                type: 'expense',
                description: '',
                amount: ''
            });

            const handleSubmit = async (e) => {
                e.preventDefault();
                const newEntry = {
                    id: Date.now(),
                    type: 'adv',
                    advType: formData.type,
                    description: formData.description,
                    amount: parseFloat(formData.amount),
                    date: new Date().toISOString()
                };

                await db.add('collections', newEntry);
                setCollections([...collections, newEntry]);
                setShowModal(false);
                setFormData({ type: 'expense', description: '', amount: '' });
            };

            const handleDelete = async (entryId) => {
                if (window.confirm('Are you sure you want to delete this entry?')) {
                    await db.delete('collections', entryId);
                    setCollections(collections.filter(entry => entry.id !== entryId));
                }
            };

            const totalExpenses = collections.filter(item => item.advType === 'expense').reduce((sum, item) => sum + item.amount, 0);
            const totalIncome = collections.filter(item => item.advType === 'income').reduce((sum, item) => sum + item.amount, 0);
            const netAmount = totalIncome - totalExpenses;

            return (
                <div className="space-y-6">
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                        <h2 className="text-2xl font-bold text-gray-800">ADV - Advances & Expenses</h2>
                        <button onClick={() => setShowModal(true)} className="flex items-center space-x-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"><Plus /><span>Add Entry</span></button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-red-500 text-white p-4 rounded-lg"><p className="text-red-100">Total Expenses</p><p className="text-2xl font-bold">₱{totalExpenses.toFixed(2)}</p></div>
                        <div className="bg-green-500 text-white p-4 rounded-lg"><p className="text-green-100">Total Income</p><p className="text-2xl font-bold">₱{totalIncome.toFixed(2)}</p></div>
                        <div className={`text-white p-4 rounded-lg ${netAmount >= 0 ? 'bg-blue-500' : 'bg-orange-500'}`}><p className="text-blue-100">Net Amount</p><p className="text-2xl font-bold">₱{netAmount.toFixed(2)}</p></div>
                    </div>

                    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Type</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {collections.map((entry) => (
                                        <tr key={entry.id} className="hover:bg-gray-50">
                                            <td className="px-6 py-4 whitespace-nowrap"><span className={`px-2 py-1 text-xs font-medium rounded-full ${entry.advType === 'expense' ? 'bg-red-100 text-red-800' : 'bg-green-100 text-green-800'}`}>{entry.advType.charAt(0).toUpperCase() + entry.advType.slice(1)}</span></td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">{entry.description}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{entry.amount.toFixed(2)}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{new Date(entry.date).toLocaleDateString()}</td>
                                            <td className="px-6 py-4 whitespace-nowrap text-sm font-medium"><button onClick={() => handleDelete(entry.id)} className="text-red-600 hover:text-red-900"><Trash2 /></button></td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    {collections.length === 0 && (
                        <div className="text-center py-12">
                            <TrendingUp className="mx-auto h-12 w-12 text-gray-400" />
                            <h3 className="mt-2 text-sm font-medium text-gray-900">No entries found</h3>
                            <p className="mt-1 text-sm text-gray-500">Start by adding an expense or income entry.</p>
                        </div>
                    )}

                    {showModal && (
                        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-lg p-6 w-full max-w-md">
                                <h3 className="text-lg font-medium text-gray-900 mb-4">Add ADV Entry</h3>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Type</label>
                                        <select value={formData.type} onChange={(e) => setFormData({ ...formData, type: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent"><option value="expense">Expense</option><option value="income">Income</option></select>
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                                        <input type="text" required value={formData.description} onChange={(e) => setFormData({ ...formData, description: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter description" />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-1">Amount (₱)</label>
                                        <input type="number" required min="0" step="0.01" value={formData.amount} onChange={(e) => setFormData({ ...formData, amount: e.target.value })} className="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Enter amount" />
                                    </div>
                                    <div className="flex space-x-3 pt-4">
                                        <button type="button" onClick={() => { setShowModal(false); setFormData({ type: 'expense', description: '', amount: '' }); }} className="flex-1 px-4 py-2 text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50">Cancel</button>
                                        <button type="submit" className="flex-1 px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700">Add Entry</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Remit Tab Component
        const RemitTab = ({ totals }) => {
            const totalBalance = Object.values(totals).reduce((sum, amount) => sum + amount, 0);
            const tabData = [
                { key: 'notebook', name: 'Notebook', color: 'blue' },
                { key: 'add', name: 'ADD', color: 'green' },
                { key: 'office', name: 'Office', color: 'indigo' },
                { key: 'gcash', name: 'GCash', color: 'teal' },
                { key: 'absent', name: 'Absent', color: 'orange' },
            ];

            return (
                <div className="space-y-6">
                    <h2 className="text-2xl font-bold text-gray-800">Remit Summary</h2>
                    
                    <div className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-lg shadow-lg">
                        <div className="text-center">
                            <p className="text-blue-100 text-lg">Total Balance to Remit</p>
                            <p className="text-4xl font-bold">₱{totalBalance.toFixed(2)}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        {tabData.map(({ key, name, color }) => {
                            const amount = totals[key] || 0;
                            const percentage = totalBalance > 0 ? (amount / totalBalance * 100) : 0;
                            return (
                                <div key={key} className="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                                    <div className="flex items-center justify-between mb-2">
                                        <h3 className="text-sm font-medium text-gray-700">{name}</h3>
                                        <span className="text-xs text-gray-500">{percentage.toFixed(1)}%</span>
                                    </div>
                                    <p className="text-2xl font-bold text-gray-900">₱{amount.toFixed(2)}</p>
                                    <div className="mt-2 bg-gray-200 rounded-full h-2">
                                        <div className={`bg-${color}-600 h-2 rounded-full transition-all duration-300`} style={{ width: `${percentage}%` }}></div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    <div className="bg-white rounded-lg border border-gray-200 overflow-hidden">
                        <div className="px-6 py-4 bg-gray-50 border-b border-gray-200">
                            <h3 className="text-lg font-medium text-gray-900">Collection Summary</h3>
                        </div>
                        <div className="overflow-x-auto">
                            <table className="w-full">
                                <thead className="bg-gray-50">
                                    <tr>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Collection Type</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                                        <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Percentage</th>
                                    </tr>
                                </thead>
                                <tbody className="bg-white divide-y divide-gray-200">
                                    {tabData.map(({ key, name }) => {
                                        const amount = totals[key] || 0;
                                        const percentage = totalBalance > 0 ? (amount / totalBalance * 100) : 0;
                                        return (
                                            <tr key={key} className="hover:bg-gray-50">
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{name} Collections</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">₱{amount.toFixed(2)}</td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{percentage.toFixed(2)}%</td>
                                            </tr>
                                        );
                                    })}
                                    <tr className="bg-blue-50 font-medium">
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">Total Balance</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">₱{totalBalance.toFixed(2)}</td>
                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-blue-900">100.00%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [activeTab, setActiveTab] = useState('database');
            const [clients, setClients] = useState([]);
            const [collections, setCollections] = useState({
                notebook: [], add: [], office: [], gcash: [], absent: [], adv: []
            });
            const [isLoading, setIsLoading] = useState(true);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        await db.init();
                        const storedClients = await db.getAll('clients');
                        const storedCollections = await db.getAll('collections');

                        if (storedClients.length === 0) {
                            const sampleClients = [
                                { id: 1, name: 'Maria Santos', loanAmount: 5000, totalAmount: 6000, dailyPayment: 125, createdAt: new Date().toISOString() },
                                { id: 2, name: 'Juan Dela Cruz', loanAmount: 10000, totalAmount: 12000, dailyPayment: 250, createdAt: new Date().toISOString() },
                                { id: 3, name: 'Ana Rodriguez', loanAmount: 3000, totalAmount: 3600, dailyPayment: 75, createdAt: new Date().toISOString() }
                            ];
                            for (const client of sampleClients) {
                                await db.add('clients', client);
                            }
                            setClients(sampleClients);
                        } else {
                            setClients(storedClients);
                        }

                        const groupedCollections = { notebook: [], add: [], office: [], gcash: [], absent: [], adv: [] };
                        storedCollections.forEach(item => {
                            if (groupedCollections[item.type]) {
                                groupedCollections[item.type].push(item);
                            }
                        });
                        setCollections(groupedCollections);
                    } catch (error) {
                        console.error("Failed to load data from IndexedDB", error);
                    } finally {
                        setIsLoading(false);
                    }
                };
                loadData();
            }, []);

            const updateCollections = useCallback((type, newCollection) => {
                setCollections(prev => ({ ...prev, [type]: newCollection }));
            }, []);

            const tabs = [
                { id: 'database', label: 'Database', icon: Database },
                { id: 'notebook', label: 'Notebook', icon: BookOpen },
                { id: 'add', label: 'ADD', icon: Plus },
                { id: 'office', label: 'Office', icon: Building },
                { id: 'gcash', label: 'Gcash', icon: Smartphone },
                { id: 'absent', label: 'Absent', icon: UserX },
                { id: 'adv', label: 'ADV', icon: TrendingUp },
                { id: 'remit', label: 'Remit', icon: DollarSign }
            ];

            const calculateTotals = () => {
                const totals = {};
                Object.keys(collections).forEach(tab => {
                    if (tab !== 'adv') {
                        totals[tab] = collections[tab].reduce((sum, entry) => sum + entry.amount, 0);
                    }
                });
                return totals;
            };

            const renderTabContent = () => {
                if (isLoading) {
                    return <div className="text-center py-20">Loading data...</div>;
                }
                switch (activeTab) {
                    case 'database':
                        return React.createElement(DatabaseTab, { clients, setClients });
                    case 'adv':
                        return React.createElement(ADVTab, { 
                            collections: collections.adv,
                            setCollections: (newCollections) => updateCollections('adv', newCollections)
                        });
                    case 'remit':
                        return React.createElement(RemitTab, { totals: calculateTotals() });
                    default:
                        return React.createElement(CollectionTab, {
                            type: activeTab,
                            clients,
                            collections: collections[activeTab],
                            setCollections: (newCollections) => updateCollections(activeTab, newCollections)
                        });
                }
            };

            return React.createElement('div', { className: 'min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100' },
                React.createElement('div', { className: 'container mx-auto px-4 py-6' },
                    React.createElement('div', { className: 'mb-8' },
                        React.createElement('h1', { className: 'text-4xl font-bold text-gray-800 mb-2' }, 'Collection Book Pro'),
                        React.createElement('p', { className: 'text-gray-600' }, 'Professional Lending Management System (Offline Mode)')
                    ),
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-lg mb-6 overflow-hidden' },
                        React.createElement('div', { className: 'flex flex-wrap border-b border-gray-200' },
                            tabs.map((tab) => {
                                const IconComponent = tab.icon;
                                return React.createElement('button', {
                                    key: tab.id,
                                    onClick: () => setActiveTab(tab.id),
                                    className: `flex items-center space-x-2 px-6 py-4 text-sm font-medium transition-colors duration-200 ${
                                        activeTab === tab.id
                                            ? 'bg-blue-600 text-white border-b-2 border-blue-600'
                                            : 'text-gray-600 hover:text-blue-600 hover:bg-blue-50'
                                    }`
                                }, React.createElement(IconComponent), React.createElement('span', {}, tab.label));
                            })
                        )
                    ),
                    React.createElement('div', { className: 'bg-white rounded-lg shadow-lg p-6 min-h-[600px]' }, renderTabContent()),
                    activeTab !== 'database' && activeTab !== 'adv' && activeTab !== 'remit' && 
                    React.createElement('div', { className: 'mt-6 grid grid-cols-1 md:grid-cols-3 gap-4' },
                        React.createElement('div', { className: 'bg-green-500 text-white p-4 rounded-lg shadow-lg' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', {},
                                    React.createElement('p', { className: 'text-green-100' }, 'Total Collections'),
                                    React.createElement('p', { className: 'text-2xl font-bold' }, `₱${calculateTotals()[activeTab]?.toFixed(2) || '0.00'}`)
                                ), React.createElement(BarChart3, { className: 'text-green-200', style: { width: '32px', height: '32px' } })
                            )
                        ),
                        React.createElement('div', { className: 'bg-blue-500 text-white p-4 rounded-lg shadow-lg' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', {},
                                    React.createElement('p', { className: 'text-blue-100' }, 'Entries Count'),
                                    React.createElement('p', { className: 'text-2xl font-bold' }, `${collections[activeTab]?.length || 0}`)
                                ), React.createElement(BookOpen, { className: 'text-blue-200', style: { width: '32px', height: '32px' } })
                            )
                        ),
                        React.createElement('div', { className: 'bg-purple-500 text-white p-4 rounded-lg shadow-lg' },
                            React.createElement('div', { className: 'flex items-center justify-between' },
                                React.createElement('div', {},
                                    React.createElement('p', { className: 'text-purple-100' }, 'Average Payment'),
                                    React.createElement('p', { className: 'text-2xl font-bold' }, `₱${collections[activeTab]?.length > 0 ? (calculateTotals()[activeTab] / collections[activeTab].length).toFixed(2) : '0.00'}`)
                                ), React.createElement(TrendingUp, { className: 'text-purple-200', style: { width: '32px', height: '32px' } })
                            )
                        )
                    )
                )
            );
        };

        ReactDOM.render(React.createElement(App), document.getElementById('root'));
    </script>
</body>
</html>
